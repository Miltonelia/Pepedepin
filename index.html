// app/page.tsx
// ────────────────────────────────────────────────────────────────
// PEPEDEPIN - DePIN dApp/Website en Next.js + Solana + Tailwind
// Versión unificada en un solo archivo para facilitar uso inicial
// ────────────────────────────────────────────────────────────────

"use client";

import Image from "next/image";
import { Button } from "@/components/ui/button";           // ← Shadcn/ui (debes tenerlo instalado)
import { WalletMultiButton } from "@solana/wallet-adapter-react-ui";
import { useWallet } from "@solana/wallet-adapter-react";
import {
  Twitter,
  MessageSquare,
  BarChart2,
  Code,
  Trophy,
  Target,
} from "lucide-react";
import { cn } from "@/lib/utils";                        // Shadcn utils
import { useState, useEffect } from "react";
import { Connection, PublicKey, clusterApiUrl } from "@solana/web3.js";
import { MerkleTree } from "merkletreejs";
import keccak256 from "keccak256";

// ────────────────────────────────────────────────
// Constantes del proyecto (no cambiar)
const TWITTER_URL    = "https://x.com/PepeDepin";
const TELEGRAM_URL   = "https://t.me/+ppq2m577cMJjOTdh";
const JUPITER_SWAP_URL = "https://jup.ag/swap/SOL-GVqPnCNNQ43TfFSAA52hwNAFxGyFw8N3H18HBFYgpump?utm_source=BitgetWallet";
const CHART_URL      = "https://dexscreener.com/solana/GVqPnCNNQ43TfFSAA52hwNAFxGyFw8N3H18HBFYgpump";
const CONTRACT_ADDRESS = "GVqPnCNNQ43TfFSAA52hwNAFxGyFw8N3H18HBFYgpump";

// Imágenes (Imgur)
const LOGO = "https://i.imgur.com/AwHcCOp.png";
const HERO_IMAGE = "https://i.imgur.com/sgafAfb.png";
const FOUNDATION_IMAGES = [
  "https://i.imgur.com/52AYrzP.png", // The Vision
  "https://i.imgur.com/VpXI9hx.png", // The Blueprints
  "https://i.imgur.com/PHUIvWG.png", // The Construction
  "https://i.imgur.com/kHpS4wG.png", // The Legacy
];

// ────────────────────────────────────────────────
// Merkle Tree de ejemplo (simulación rewards DePIN)
const exampleLeaves = ["user1", "user2", "user3", "arquitectoX"].map(x => keccak256(x));
const merkleTree = new MerkleTree(exampleLeaves, keccak256, { sortPairs: true });
const merkleRoot = merkleTree.getRoot().toString("hex");

// ────────────────────────────────────────────────
// Componente principal
export default function Home() {
  const { publicKey } = useWallet();
  const [isConnected, setIsConnected] = useState(false);
  const [proof, setProof] = useState<string[]>([]);
  const [rewardsClaimed, setRewardsClaimed] = useState(false);

  useEffect(() => {
    setIsConnected(!!publicKey);
  }, [publicKey]);

  // Genera prueba Merkle usando la dirección de la wallet como leaf
  const generateProof = (address: string) => {
    const hashedLeaf = keccak256(address);
    const proof = merkleTree.getProof(hashedLeaf);
    return proof.map(p => p.data.toString("hex"));
  };

  // Simulación de claim (en producción → tx real en Solana)
  const claimRewards = async () => {
    if (!publicKey) return;

    const newProof = generateProof(publicKey.toBase58());
    setProof(newProof);

    // Aquí iría la lógica real de transacción con el programa Solana
    console.log("Reclamando rewards con proof:", newProof);
    console.log("Merkle Root esperado:", merkleRoot);

    // Simulamos éxito
    setRewardsClaimed(true);
  };

  return (
    <div className="min-h-screen bg-[#050505] text-white font-mono">
      {/* ─── Header Sticky ──────────────────────────────────────── */}
      <header className="sticky top-0 z-50 bg-[#050505]/80 backdrop-blur-md border-b border-[#1A1A1A]">
        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center space-x-4">
            <Image src={LOGO} alt="PEPEDEPIN Logo" width={40} height={40} className="rounded-full" />
            <nav className="hidden md:flex space-x-8 font-orbitron text-lg">
              <a href="#empire" className="hover:text-[#39FF14] transition-colors">EMPIRE</a>
              <a href="#tools" className="hover:text-[#39FF14] transition-colors">TOOLS</a>
              <a href="#foundation" className="hover:text-[#39FF14] transition-colors">ARCHITECTS</a>
            </nav>
          </div>

          <div className="flex items-center space-x-5">
            <a href={TWITTER_URL} target="_blank" rel="noopener noreferrer">
              <Twitter className="w-6 h-6 hover:text-[#39FF14] transition-colors" />
            </a>
            <a href={TELEGRAM_URL} target="_blank" rel="noopener noreferrer">
              <MessageSquare className="w-6 h-6 hover:text-[#39FF14] transition-colors" />
            </a>

            <WalletMultiButton
              className={cn(
                "bg-[#39FF14] text-black hover:bg-[#D4AF37] px-5 py-2.5 rounded font-bold transition-colors",
                isConnected && "bg-[#D4AF37] text-black"
              )}
            />
          </div>
        </div>
      </header>

      {/* ─── Hero ───────────────────────────────────────────────── */}
      <section id="empire" className="relative h-screen flex items-center justify-center overflow-hidden">
        <Image
          src={HERO_IMAGE}
          alt="The King on the Throne"
          fill
          className="object-cover opacity-40"
          priority
        />
        <div className="relative z-10 text-center px-6 max-w-5xl">
          <h1 className="font-orbitron text-5xl sm:text-6xl md:text-8xl text-[#D4AF37] mb-6 tracking-tight">
            THE CORONATION HAS BEGUN
          </h1>
          <p className="text-xl md:text-2xl mb-10 opacity-90">
            Building the future of DePIN on Solana.<br className="sm:hidden" /> By Architects, for an eternal legacy.
          </p>

          <div className="flex flex-col sm:flex-row justify-center gap-5">
            <Button asChild size="lg" className="bg-[#39FF14] text-black hover:bg-[#D4AF37] text-lg font-bold px-10">
              <a href={JUPITER_SWAP_URL} target="_blank" rel="noopener noreferrer">
                BUY $PEPEDEPIN
              </a>
            </Button>
            <Button
              variant="outline"
              size="lg"
              asChild
              className="border-[#39FF14] text-[#39FF14] hover:bg-[#39FF14]/20 hover:text-white text-lg font-bold px-10"
            >
              <a href={CHART_URL} target="_blank" rel="noopener noreferrer">
                LIVE CHART
              </a>
            </Button>
          </div>
        </div>
      </section>

      {/* ─── Architect Tools ────────────────────────────────────── */}
      <section id="tools" className="py-20 bg-gradient-to-b from-[#050505] to-[#1A1A1A]/40">
        <div className="max-w-7xl mx-auto px-6">
          <h2 className="font-orbitron text-4xl md:text-5xl text-[#D4AF37] mb-16 text-center">ARCHITECT TOOLS</h2>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            {/* AI PROPAGANDA */}
            <div className="bg-[#1A1A1A] p-8 rounded-xl border border-[#39FF14]/30 hover:border-[#39FF14] transition-all duration-300 hover:shadow-[0_0_25px_rgba(57,255,20,0.25)]">
              <Code className="w-14 h-14 text-[#39FF14] mb-6" />
              <h3 className="font-orbitron text-2xl mb-4">AI PROPAGANDA</h3>
              <p className="mb-6 text-gray-300">Visual generator tool for empire-building content.</p>
              <Button className="w-full bg-[#39FF14]/90 hover:bg-[#39FF14] text-black">Launch Generator</Button>
            </div>

            {/* REWARDS PORTAL */}
            <div className="bg-[#1A1A1A] p-8 rounded-xl border border-[#39FF14]/30 hover:border-[#39FF14] transition-all duration-300 hover:shadow-[0_0_25px_rgba(57,255,20,0.25)]">
              <Trophy className="w-14 h-14 text-[#39FF14] mb-6" />
              <h3 className="font-orbitron text-2xl mb-4">REWARDS PORTAL</h3>
              <p className="mb-6 text-gray-300">Claim rewards using Merkle Proofs (Solana DePIN standard).</p>

              {isConnected ? (
                <Button
                  onClick={claimRewards}
                  className="w-full bg-[#39FF14]/90 hover:bg-[#39FF14] text-black"
                  disabled={rewardsClaimed}
                >
                  {rewardsClaimed ? "Rewards Claimed ✓" : "Claim Rewards"}
                </Button>
              ) : (
                <p className="text-center text-[#D4AF37] font-medium">Connect wallet to claim</p>
              )}

              {proof.length > 0 && (
                <div className="mt-6 text-xs bg-black/40 p-3 rounded font-mono overflow-x-auto">
                  <p className="text-[#39FF14] mb-1">Proof generated:</p>
                  {proof.map((p, i) => <div key={i}>{p}</div>)}
                </div>
              )}
            </div>

            {/* RAID COORDINATOR */}
            <div className="bg-[#1A1A1A] p-8 rounded-xl border border-[#39FF14]/30 hover:border-[#39FF14] transition-all duration-300 hover:shadow-[0_0_25px_rgba(57,255,20,0.25)]">
              <Target className="w-14 h-14 text-[#39FF14] mb-6" />
              <h3 className="font-orbitron text-2xl mb-4">RAID COORDINATOR</h3>
              <p className="mb-6 text-gray-300">Latest social missions & coordinated raids.</p>
              <Button asChild className="w-full bg-[#39FF14]/90 hover:bg-[#39FF14] text-black">
                <a href={TELEGRAM_URL} target="_blank" rel="noopener noreferrer">
                  Join Missions
                </a>
              </Button>
            </div>
          </div>
        </div>
      </section>

      {/* ─── The Foundation ─────────────────────────────────────── */}
      <section id="foundation" className="py-20">
        <div className="max-w-7xl mx-auto px-6 grid md:grid-cols-2 gap-12 items-center">
          {/* Narrativa izquierda */}
          <div>
            <h2 className="font-orbitron text-4xl md:text-5xl text-[#D4AF37] mb-8">THE FOUNDATION</h2>
            <p className="text-lg leading-relaxed mb-6">
              In the shadows of the digital realm, <strong>100 Architects</strong> rise to forge an empire on Solana.
              United by vision, blueprints, construction and legacy — they build DePIN infrastructure that defies time.
            </p>
            <p className="text-lg leading-relaxed mb-8">
              Each Architect contributes to the grand design, securing rewards through Merkle-verified proofs,
              ensuring fairness and immortality of the empire.
            </p>

            {/* Technical box */}
            <div className="bg-[#1A1A1A] p-6 rounded-xl border border-[#D4AF37]/30">
              <h3 className="font-orbitron text-xl text-[#D4AF37] mb-4">TECHNICAL SPECIFICATIONS</h3>
              <div className="space-y-2 text-sm font-mono">
                <div><strong>Contract Address:</strong> <span className="break-all">{CONTRACT_ADDRESS}</span></div>
                <div><strong>Token Standard:</strong> SPL (Solana Program Library)</div>
                <div><strong>Governance:</strong> Squads Multisig</div>
              </div>
            </div>
          </div>

          {/* Galería derecha */}
          <div className="grid grid-cols-2 gap-5">
            {FOUNDATION_IMAGES.map((src, i) => (
              <div
                key={i}
                className="relative aspect-square rounded-xl overflow-hidden border border-[#39FF14]/20 hover:border-[#39FF14] transition-all duration-300 hover:scale-[1.03]"
              >
                <Image
                  src={src}
                  alt={`Foundation stage ${i + 1}`}
                  fill
                  className="object-cover"
                />
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* ─── Footer ─────────────────────────────────────────────── */}
      <footer className="bg-[#0a0a0a] py-10 text-center border-t border-[#1A1A1A]">
        <p className="text-gray-500 mb-4">
          © {new Date().getFullYear()} PEPEDEPIN Empire — Built for eternity.
        </p>
        <div className="flex justify-center gap-6">
          <a href={TWITTER_URL} target="_blank" rel="noopener noreferrer"><Twitter className="w-5 h-5 hover:text-[#39FF14]" /></a>
          <a href={TELEGRAM_URL} target="_blank" rel="noopener noreferrer"><MessageSquare className="w-5 h-5 hover:text-[#39FF14]" /></a>
          <a href={CHART_URL} target="_blank" rel="noopener noreferrer"><BarChart2 className="w-5 h-5 hover:text-[#39FF14]" /></a>
        </div>
      </footer>
    </div>
  );
}
