// app/page.tsx
"use client";

import Image from "next/image";
import { Button } from "@/components/ui/button";
import { WalletMultiButton } from "@solana/wallet-adapter-react-ui";
import { useWallet } from "@solana/wallet-adapter-react";
import { Twitter, MessageSquare, BarChart2, Code, Trophy, Target } from "lucide-react";
import { cn } from "@/lib/utils";
import { useState, useEffect } from "react";
import { MerkleTree } from "merkletreejs";
import keccak256 from "keccak256";

const TWITTER_URL = "https://x.com/PepeDepin";
const TELEGRAM_URL = "https://t.me/+ppq2m577cMJjOTdh";
const JUPITER_SWAP_URL = "https://jup.ag/swap/SOL-GVqPnCNNQ43TfFSAA52hwNAFxGyFw8N3H18HBFYgpump?utm_source=BitgetWallet";
const CHART_URL = "https://dexscreener.com/solana/GVqPnCNNQ43TfFSAA52hwNAFxGyFw8N3H18HBFYgpump";
const CONTRACT_ADDRESS = "GVqPnCNNQ43TfFSAA52hwNAFxGyFw8N3H18HBFYgpump";

const LOGO = "https://i.imgur.com/AwHcCOp.png";
const HERO_IMAGE = "https://i.imgur.com/sgafAfb.png";
const FOUNDATION_IMAGES = [
  "https://i.imgur.com/52AYrzP.png",
  "https://i.imgur.com/VpXI9hx.png",
  "https://i.imgur.com/PHUIvWG.png",
  "https://i.imgur.com/kHpS4wG.png",
];

const exampleLeaves = ["user1", "user2", "user3", "arquitectoX"].map(x => keccak256(x));
const merkleTree = new MerkleTree(exampleLeaves, keccak256, { sortPairs: true });
const merkleRoot = merkleTree.getRoot().toString("hex");

export default function Home() {
  const { publicKey } = useWallet();
  const [isConnected, setIsConnected] = useState(false);
  const [proof, setProof] = useState<string[]>([]);
  const [rewardsClaimed, setRewardsClaimed] = useState(false);

  useEffect(() => {
    setIsConnected(!!publicKey);
  }, [publicKey]);

  const generateProof = (address: string) => {
    const hashedLeaf = keccak256(address);
    const proof = merkleTree.getProof(hashedLeaf);
    return proof.map(p => p.data.toString("hex"));
  };

  const claimRewards = async () => {
    if (!publicKey) return;
    const newProof = generateProof(publicKey.toBase58());
    setProof(newProof);
    console.log("Reclamando rewards con proof:", newProof);
    console.log("Merkle Root esperado:", merkleRoot);
    setRewardsClaimed(true);
  };

  return (
    <div className="min-h-screen bg-[#050505] text-white font-mono overflow-hidden">
      <header className="sticky top-0 z-50 bg-[#050505]/90 backdrop-blur-lg border-b border-[#39FF14]/20 shadow-[0_0_15px_rgba(57,255,20,0.1)]">
        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center space-x-4">
            <Image src={LOGO} alt="PEPEDEPIN Logo" width={48} height={48} className="rounded-full shadow-[0_0_10px_rgba(57,255,20,0.5)]" />
            <nav className="hidden md:flex space-x-8 font-orbitron text-xl tracking-wide">
              <a href="#empire" className="hover:text-[#39FF14] transition-all duration-300 hover:shadow-[0_0_10px_rgba(57,255,20,0.8)]">EMPIRE</a>
              <a href="#tools" className="hover:text-[#39FF14] transition-all duration-300 hover:shadow-[0_0_10px_rgba(57,255,20,0.8)]">TOOLS</a>
              <a href="#foundation" className="hover:text-[#39FF14] transition-all duration-300 hover:shadow-[0_0_10px_rgba(57,255,20,0.8)]">ARCHITECTS</a>
            </nav>
          </div>
          <div className="flex items-center space-x-6">
            <a href={TWITTER_URL} target="_blank" rel="noopener noreferrer" className="hover:scale-110 transition-transform">
              <Twitter className="w-7 h-7 hover:text-[#39FF14] transition-colors" />
            </a>
            <a href={TELEGRAM_URL} target="_blank" rel="noopener noreferrer" className="hover:scale-110 transition-transform">
              <MessageSquare className="w-7 h-7 hover:text-[#39FF14] transition-colors" />
            </a>
            <WalletMultiButton
              className={cn(
                "bg-[#39FF14] text-black hover:bg-[#D4AF37] px-6 py-3 rounded-lg font-bold transition-all duration-300 hover:shadow-[0_0_20px_rgba(212,175,55,0.6)]",
                isConnected && "bg-[#D4AF37] text-black"
              )}
            />
          </div>
        </div>
      </header>

      <section id="empire" className="relative h-screen flex items-center justify-center overflow-hidden bg-gradient-to-b from-[#050505] to-[#0a0a0a]">
        <Image src={HERO_IMAGE} alt="The King on the Throne" fill className="object-cover opacity-50 scale-105 animate-subtle-pulse" priority />
        <div className="relative z-10 text-center px-6 max-w-5xl">
          <h1 className="font-orbitron text-5xl sm:text-7xl md:text-9xl text-[#D4AF37] mb-6 tracking-tight drop-shadow-[0_0_10px_rgba(212,175,55,0.8)] animate-fade-in">
            THE CORONATION HAS BEGUN
          </h1>
          <p className="text-xl md:text-3xl mb-12 opacity-90 font-space-mono tracking-wide">
            Building the future of DePIN on Solana. By Architects, for an eternal legacy.
          </p>
          <div className="flex flex-col sm:flex-row justify-center gap-6">
            <Button asChild size="lg" className="bg-[#39FF14] text-black hover:bg-[#D4AF37] text-xl font-bold px-12 py-4 rounded-lg transition-all hover:shadow-[0_0_25px_rgba(57,255,20,0.7)]">
              <a href={JUPITER_SWAP_URL} target="_blank" rel="noopener noreferrer">BUY $PEPEDEPIN</a>
            </Button>
            <Button variant="outline" size="lg" asChild className="border-2 border-[#39FF14] text-[#39FF14] hover:bg-[#39FF14] hover:text-black text-xl font-bold px-12 py-4 rounded-lg transition-all hover:shadow-[0_0_25px_rgba(57,255,20,0.7)]">
              <a href={CHART_URL} target="_blank" rel="noopener noreferrer">LIVE CHART</a>
            </Button>
          </div>
        </div>
      </section>

      <section id="tools" className="py-24 bg-gradient-to-b from-[#050505] to-[#1A1A1A]/50">
        <div className="max-w-7xl mx-auto px-6">
          <h2 className="font-orbitron text-5xl md:text-6xl text-[#D4AF37] mb-20 text-center drop-shadow-[0_0_15px_rgba(212,175,55,0.5)]">ARCHITECT TOOLS</h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-10">
            <div className="bg-[#1A1A1A]/80 p-10 rounded-2xl border border-[#39FF14]/40 hover:border-[#39FF14] transition-all duration-500 hover:shadow-[0_0_30px_rgba(57,255,20,0.4)] backdrop-blur-sm">
              <Code className="w-16 h-16 text-[#39FF14] mb-8 mx-auto" />
              <h3 className="font-orbitron text-3xl mb-6 text-center">AI PROPAGANDA</h3>
              <p className="mb-8 text-gray-300 text-center font-space-mono">Visual generator tool for empire-building content.</p>
              <Button className="w-full bg-[#39FF14] hover:bg-[#D4AF37] text-black text-lg font-bold py-4 transition-all hover:shadow-[0_0_20px_rgba(212,175,55,0.6)]">Launch Generator</Button>
            </div>
            <div className="bg-[#1A1A1A]/80 p-10 rounded-2xl border border-[#39FF14]/40 hover:border-[#39FF14] transition-all duration-500 hover:shadow-[0_0_30px_rgba(57,255,20,0.4)] backdrop-blur-sm">
              <Trophy className="w-16 h-16 text-[#39FF14] mb-8 mx-auto" />
              <h3 className="font-orbitron text-3xl mb-6 text-center">REWARDS PORTAL</h3>
              <p className="mb-8 text-gray-300 text-center font-space-mono">Claim rewards using Merkle Proofs (Solana DePIN standard).</p>
              {isConnected ? (
                <Button onClick={claimRewards} className="w-full bg-[#39FF14] hover:bg-[#D4AF37] text-black text-lg font-bold py-4 transition-all hover:shadow-[0_0_20px_rgba(212,175,55,0.6)]" disabled={rewardsClaimed}>
                  {rewardsClaimed ? "Rewards Claimed ✓" : "Claim Rewards"}
                </Button>
              ) : (
                <p className="text-center text-[#D4AF37] font-bold text-lg">Connect wallet to claim</p>
              )}
              {proof.length > 0 && (
                <div className="mt-8 text-sm bg-black/50 p-4 rounded-lg font-mono overflow-x-auto border border-[#39FF14]/30">
                  <p className="text-[#39FF14] mb-2 font-bold">Proof generated:</p>
                  {proof.map((p, i) => <div key={i} className="truncate">{p}</div>)}
                </div>
              )}
            </div>
            <div className="bg-[#1A1A1A]/80 p-10 rounded-2xl border border-[#39FF14]/40 hover:border-[#39FF14] transition-all duration-500 hover:shadow-[0_0_30px_rgba(57,255,20,0.4)] backdrop-blur-sm">
              <Target className="w-16 h-16 text-[#39FF14] mb-8 mx-auto" />
              <h3 className="font-orbitron text-3xl mb-6 text-center">RAID COORDINATOR</h3>
              <p className="mb-8 text-gray-300 text-center font-space-mono">Latest social missions & coordinated raids.</p>
              <Button asChild className="w-full bg-[#39FF14] hover:bg-[#D4AF37] text-black text-lg font-bold py-4 transition-all hover:shadow-[0_0_20px_rgba(212,175,55,0.6)]">
                <a href={TELEGRAM_URL} target="_blank" rel="noopener noreferrer">Join Missions</a>
              </Button>
            </div>
          </div>
        </div>
      </section>

      <section id="foundation" className="py-24 bg-[#050505]">
        <div className="max-w-7xl mx-auto px-6 grid md:grid-cols-2 gap-16 items-start">
          <div className="sticky top-20">
            <h2 className="font-orbitron text-5xl md:text-6xl text-[#D4AF37] mb-10 drop-shadow-[0_0_15px_rgba(212,175,55,0.5)]">THE FOUNDATION</h2>
            <p className="text-xl leading-relaxed mb-8 font-space-mono text-gray-200">
              In the shadows of the digital realm, <strong className="text-[#39FF14]">100 Architects</strong> rise to forge an empire on Solana. United by vision, blueprints, construction and legacy — they build DePIN infrastructure that defies time.
            </p>
            <p className="text-xl leading-relaxed mb-12 font-space-mono text-gray-200">
              Each Architect contributes to the grand design, securing rewards through Merkle-verified proofs, ensuring fairness and immortality of the empire.
            </p>
            <div className="bg-[#1A1A1A]/80 p-8 rounded-2xl border border-[#D4AF37]/40 shadow-[0_0_20px_rgba(212,175,55,0.2)] backdrop-blur-sm">
              <h3 className="font-orbitron text-2xl text-[#D4AF37] mb-6">TECHNICAL SPECIFICATIONS</h3>
              <div className="space-y-4 text-base font-mono text-gray-300">
                <div><strong className="text-[#39FF14]">Contract Address:</strong> <span className="break-all">{CONTRACT_ADDRESS}</span></div>
                <div><strong className="text-[#39FF14]">Token Standard:</strong> SPL (Solana Program Library)</div>
                <div><strong className="text-[#39FF14]">Governance:</strong> Squads Multisig</div>
              </div>
            </div>
          </div>
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-8">
            {FOUNDATION_IMAGES.map((src, i) => (
              <div key={i} className="relative aspect-square rounded-2xl overflow-hidden border border-[#39FF14]/30 hover:border-[#39FF14] transition-all duration-500 hover:scale-105 hover:shadow-[0_0_40px_rgba(57,255,20,0.5)]">
                <Image src={src} alt={`Foundation stage ${i + 1}`} fill className="object-cover transform hover:scale-110 transition-transform duration-700" />
              </div>
            ))}
          </div>
        </div>
      </section>

      <footer className="bg-[#0a0a0a]/90 py-12 text-center border-t border-[#39FF14]/20 shadow-[0_0_15px_rgba(57,255,20,0.1)]">
        <p className="text-gray-400 mb-6 text-lg font-space-mono">© {new Date().getFullYear()} PEPEDEPIN Empire — Built for eternity.</p>
        <div className="flex justify-center gap-8">
          <a href={TWITTER_URL} target="_blank" rel="noopener noreferrer" className="hover:scale-110 transition-transform"><Twitter className="w-6 h-6 hover:text-[#39FF14]" /></a>
          <a href={TELEGRAM_URL} target="_blank" rel="noopener noreferrer" className="hover:scale-110 transition-transform"><MessageSquare className="w-6 h-6 hover:text-[#39FF14]" /></a>
          <a href={CHART_URL} target="_blank" rel="noopener noreferrer" className="hover:scale-110 transition-transform"><BarChart2 className="w-6 h-6 hover:text-[#39FF14]" /></a>
        </div>
      </footer>
    </div>
  );
}
