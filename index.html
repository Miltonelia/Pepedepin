// app/page.tsx
"use client";

import Image from "next/image";
import { Button } from "@/components/ui/button";
import { WalletMultiButton } from "@solana/wallet-adapter-react-ui";
import { useWallet } from "@solana/wallet-adapter-react";
import {
  Twitter,
  MessageSquare,
  BarChart2,
  Code,
  Trophy,
  Target,
} from "lucide-react";
import { cn } from "@/lib/utils";
import { useState, useEffect } from "react";
import { Connection, PublicKey, clusterApiUrl } from "@solana/web3.js";
import { MerkleTree } from "merkletreejs";
import keccak256 from "keccak256";

const TWITTER_URL    = "https://x.com/PepeDepin";
const TELEGRAM_URL   = "https://t.me/+ppq2m577cMJjOTdh";
const JUPITER_SWAP_URL = "https://jup.ag/swap/SOL-GVqPnCNNQ43TfFSAA52hwNAFxGyFw8N3H18HBFYgpump?utm_source=BitgetWallet";
const CHART_URL      = "https://dexscreener.com/solana/GVqPnCNNQ43TfFSAA52hwNAFxGyFw8N3H18HBFYgpump";
const CONTRACT_ADDRESS = "GVqPnCNNQ43TfFSAA52hwNAFxGyFw8N3H18HBFYgpump";

const LOGO = "https://i.imgur.com/AwHcCOp.png";
const HERO_IMAGE = "https://i.imgur.com/sgafAfb.png";
const FOUNDATION_IMAGES = [
  "https://i.imgur.com/52AYrzP.png",
  "https://i.imgur.com/VpXI9hx.png",
  "https://i.imgur.com/PHUIvWG.png",
  "https://i.imgur.com/kHpS4wG.png",
];

const exampleLeaves = ["user1", "user2", "user3", "arquitectoX"].map(x => keccak256(x));
const merkleTree = new MerkleTree(exampleLeaves, keccak256, { sortPairs: true });
const merkleRoot = merkleTree.getRoot().toString("hex");

export default function Home() {
  const { publicKey } = useWallet();
  const [isConnected, setIsConnected] = useState(false);
  const [proof, setProof] = useState<string[]>([]);
  const [rewardsClaimed, setRewardsClaimed] = useState(false);

  useEffect(() => {
    setIsConnected(!!publicKey);
  }, [publicKey]);

  const generateProof = (address: string) => {
    const hashedLeaf = keccak256(address);
    const proof = merkleTree.getProof(hashedLeaf);
    return proof.map(p => p.data.toString("hex"));
  };

  const claimRewards = async () => {
    if (!publicKey) return;

    const newProof = generateProof(publicKey.toBase58());
    setProof(newProof);

    console.log("Reclamando rewards con proof:", newProof);
    console.log("Merkle Root esperado:", merkleRoot);

    setRewardsClaimed(true);
  };

  return (
    <div className="min-h-screen bg-[#050505] text-white font-mono overflow-hidden">
      <header className="sticky top-0 z-50 bg-[#050505]/90 backdrop-blur-lg border-b border-[#39FF14]/20 shadow-[0_0_15px_rgba(57,255,20,0.1)]">
        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center space-x-4">
            <Image src={LOGO} alt="PEPEDEPIN Logo" width={48} height={48} className="rounded-full shadow-[0_0_10px_rgba(57,255,20,0.5)]" />
            <nav className="hidden md:flex space-x-8 font-orbitron text-xl tracking-wide">
              <a href="#empire" className="hover:text-[#39FF14] transition-all duration-300 hover:shadow-[0_0_10px_rgba(57,255,20,0.8)]">EMPIRE</a>
              <a href="#tools" className="hover:text-[#39FF14] transition-all duration-300 hover:shadow-[0_0_10px_rgba(57,255,20,0.8)]">TOOLS</a>
              <a href="#foundation" className="hover:text-[#39FF14] transition-all duration-300 hover:shadow-[0_0_10px_rgba(57,255,20,0.8)]">ARCHITECTS</a>
            </nav>
          </div>

          <div className="flex items-center space-x-6">
            <a href={TWITTER_URL} target="_blank" rel="noopener noreferrer" className="hover:scale-110 transition-transform">
              <Twitter className="w-7 h-7 hover:text-[#39FF14] transition-colors" />
            </a>
            <a href={TELEGRAM_URL} target="_blank" rel="noopener noreferrer" className="hover:scale-110 transition-transform">
              <MessageSquare className="w-7 h-7 hover:text-[#39FF14] transition-colors" />
            </a>

            <WalletMultiButton
              className={cn(
                "bg-[#39FF14] text-black hover:bg-[#D4AF37] px-6 py-3 rounded-lg font-bold transition-all duration-300 hover:shadow-[0_0_20px_rgba(212,175,55,0.6)]",
                isConnected && "bg-[#D4AF37] text-black"
              )}
            />
          </div>
        </div>
      </header>

      <section id="empire" className="relative h-screen flex items-center justify-center overflow-hidden bg-gradient-to-b from-[#050505] to-[#0a0a0a]">
        <Image
          src={HERO_IMAGE}
          alt="The King on the Throne"
          fill
          className="object-cover opacity-50 scale-105 animate-subtle-pulse"
          priority
        />
        <div className="relative z-10 text-center px-6 max-w-5xl">
          <h1 className="font-orbitron text-5xl sm:text-7xl md:text-9xl text-[#D4AF37] mb-6 tracking-tight drop-shadow-[0_0_10px_rgba(212,175,55,0.8)] animate-fade-in">
            THE CORONATION HAS BEGUN
          </h1>
          <p className="text-xl md:text-3xl mb-12 opacity-90 font-space-mono tracking-wide">
            Building the future of DePIN on Solana. By Architects, for an eternal legacy.
          </p>

          <div className="flex flex-col sm:flex-row justify-center gap-6">
            <Button asChild size="lg" className="bg-[#39FF14] text-black hover:bg-[#D4AF37] text-xl font-bold px-12 py-4 rounded-lg transition-all hover:shadow-[0_0_25px_rgba(57,255,20,0.7)]">
              <a href={JUPITER_SWAP_URL} target="_blank" rel="noopener noreferrer">
                BUY $PEPEDEPIN
              </a>
            </Button>
            <Button
              variant="outline"
              size="lg"
              asChild
              className="border-2 border-[#39FF14] text-[#39FF14] hover:bg-[#39FF14] hover:text-black text-xl font-bold px-
